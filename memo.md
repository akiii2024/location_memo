#変更点
実際の地図じゃなくてフィールドワークように用意された地図を使用(pdf,画像)
それに対しピンを打つ
情報を一杯乗せられるようにしたい（時間、発見者、標本番号など）
印刷したい（ピンが乗ってる地図、ピンの情報一覧）
#余裕があってできたら
地図に対してグリッドで区切って、それを座標とする
自分で座標を決められる機能。
オンラインで共有できたら便利（オプション）

---

# アプリ全体分析結果 (AI分析レポート)

## 現在の実装状況 ✅

### ✅ 完全実装済み
- カスタム地図（PDF/画像）の読み込み・表示
- 地図上のピン配置機能
- 詳細メモ情報（発見時間、発見者、標本番号、カテゴリ、備考）
- 印刷機能（地図画像、ピン付き地図、メモリスト、PDFレポート）
- SQLiteデータベースによるデータ管理
- メモ・地図の検索機能
- 地図の追加・削除・名称変更
- ピン番号の自動割り当て
- ズーム機能（ピンサイズの動的調整）
- 日本語フォント対応
- ダークモード

### ⚠️ 部分実装・制限あり
- 位置情報機能（現在無効化、デモ位置のみ）
- 通知機能（UI作成済みだが機能未実装）
- データ管理機能（設定画面に項目あるが実装予定）

### ❌ 未実装（memo.mdの要望）
- グリッド座標機能
- 手動座標指定機能
- オンライン共有機能

## 追加すべき優先機能

### 🔥 高優先度
1. **グリッド座標システム**
   - 地図にグリッドオーバーレイ表示
   - グリッド単位での座標指定
   - グリッドサイズのカスタマイズ

2. **手動座標入力機能**
   - 緯度経度の直接入力
   - 相対座標の手動指定
   - 座標フォーマットの選択（度分秒、小数点など）

3. **写真・画像添付機能**
   - メモに写真を複数枚添付
   - 画像のズーム・トリミング
   - サムネイル表示

4. **位置情報機能の再有効化**
   - GPS位置情報の取得
   - 位置精度の表示
   - 位置履歴の記録

### 🔸 中優先度
5. **音声メモ機能**
   - 音声録音・再生
   - 音声ファイルの管理
   - 音声の波形表示

6. **データ管理機能の完全実装**
   - データのバックアップ・復元
   - CSV/KMLエクスポート
   - データ同期機能

7. **フィルタリング・ソート機能の拡張**
   - 日付範囲フィルタ
   - カテゴリフィルタ
   - 発見者フィルタ
   - 複数条件の組み合わせ

8. **ピン管理機能**
   - 複数ピンの一括選択・操作
   - ピンの移動・編集
   - ピンスタイルのカスタマイズ

### 🔹 低優先度
9. **オンライン共有機能**
   - クラウドストレージ連携
   - チーム共有機能
   - リアルタイム同期

10. **アクセシビリティ向上**
    - スクリーンリーダー対応
    - 高コントラストモード
    - フォントサイズ調整

## 修正すべき点

### 🐛 バグ・問題点
1. **位置情報機能の再有効化**
   - geolocatorパッケージのコメントアウト解除
   - 権限管理の実装
   - エラーハンドリングの改善

2. **パフォーマンス最適化**
   - 大量のピンがある場合の描画最適化
   - 大きな画像ファイルの読み込み最適化
   - データベースクエリの最適化

3. **エラーハンドリング強化**
   - ファイル読み込みエラーの詳細対応
   - ネットワークエラー対応
   - データベースエラーの復旧機能

### 🎨 UI/UX改善
4. **タブレット対応**
   - レスポンシブデザインの改善
   - 大画面での操作性向上
   - ピンチ操作の最適化

5. **ダークモード完全対応**
   - 全画面でのダークモード統一
   - カスタムテーマ機能
   - システム設定との連動

6. **操作性向上**
   - ピンのドラッグ移動機能
   - コンテキストメニューの追加
   - ショートカット機能

### 🔒 セキュリティ・安定性
7. **データセキュリティ**
   - データベースの暗号化
   - ファイルの暗号化
   - パスワード保護機能

8. **バックアップ機能**
   - 自動バックアップ
   - 段階的復元機能
   - データ整合性チェック

## 技術的改善提案

### 📱 アーキテクチャ改善
- 状態管理の強化（Riverpod導入検討）
- テストコードの追加（Unit/Widget/Integration）
- CI/CDパイプラインの構築

### 🚀 新技術導入
- 機械学習による自動カテゴリ分類
- OCR機能による文字認識
- AR機能による現地確認

### 📊 分析機能
- メモの統計・分析機能
- ヒートマップ表示
- レポート自動生成

## まとめ

現在のアプリは基本機能が充実していますが、フィールドワークの効率をさらに向上させるため、グリッド座標機能と写真添付機能を最優先で実装することを推奨します。また、位置情報機能の再有効化により、実用性が大幅に向上すると考えられます。
### UIの使いにくさの具体例
- アプリ起動時に毎回α版警告ダイアログがバリア不可視状態で表示され、チェックボックスを操作しなければ閉じても再表示される設計になっているため、初回以降も不要な操作が発生します。【F:lib/screens/main_screen.dart†L29-L134】
- ホーム画面ではアプリバーとフローティングアクションボタンの双方に同じ「新しい地図を追加」アクションが配置されており、操作経路が重複してUIが冗長になっています。【F:lib/screens/home_screen.dart†L844-L871】
- オンライン地図のダイアログは幅420、高さ320ピクセルの固定サイズで構築されているため、モバイル端末など狭い画面でははみ出しやスクロール不能な領域が発生しやすくなっています。【F:lib/screens/home_screen.dart†L593-L694】
- 検索画面は文字を入力するたびに即座に検索処理を走らせ、結果リストがスピナーに置き換わるため、入力途中のチラつきやレスポンス低下を招きます。検索実行の明示的なトリガーも用意されていません。【F:lib/screens/search_screen.dart†L24-L151】
- Web環境向けにボトムナビゲーションのラベルフォントを10pxまで小さくしており、視認性やタップターゲットの誤認につながる恐れがあります。【F:lib/screens/main_screen.dart†L177-L198】

### アプリ全体のフロー上の問題点
- 初回起動時はスプラッシュで3秒待機した後に6ページ構成のチュートリアルを経由し、さらに認証画面かメイン画面へ遷移するため、実際の地図操作までに複数ステップを強いられます。またメイン画面へ着地すると即座にα版警告ダイアログがモーダル表示され、連続して操作を阻害します。【F:lib/screens/splash_screen.dart†L24-L66】【F:lib/screens/tutorial_screen.dart†L17-L146】【F:lib/screens/main_screen.dart†L26-L134】
- オンライン機能を使おうとすると、オフラインモード時はホーム画面でスナックバーにより「設定からオンラインモードに切り替えてください」と案内され、ユーザー自身が設定タブに移動してオフライン解除→再度認証画面に遷移する必要があり、操作経路が複雑です。【F:lib/screens/home_screen.dart†L52-L76】【F:lib/screens/settings_screen.dart†L1219-L1235】
- 地図画面のアプリバー右端にある「印刷」メニュー内へ共同編集の有効化/無効化やFirebase同期など本来別カテゴリの操作がまとめて詰め込まれており、印刷系と共有系が混在したまま多段メニューをたどらないと目的機能に辿り着けません。【F:lib/screens/map_screen.dart†L1010-L1287】
